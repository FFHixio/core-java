syntax = "proto3";

package spine.server.model;

import "spine/options.proto";

option (type_url_prefix) = "type.spine.io";
option java_package = "io.spine.server.model";
option java_outer_classname = "MessageHandlerProto";
option java_multiple_files = true;

option (internal_all) = true;

import "google/protobuf/any.proto";

import "spine/base/field_path.proto";

// A message handler identifier.
//
// All the message handlers of an entity must have distinct IDs.
//
message HandlerId {

    // The information about the handled message type.
    HandlerTypeInfo type = 1 [(validate) = true];

    // The filter which the handled messages must match.
    MessageFilter filter = 2 [(required) = false, (validate) = true];
}

// A message handler type information.
//
message HandlerTypeInfo {

    // The type URL of the handled message.
    string message_type = 1 [(required) = true];

    // The type URL of the handled message origin message.
    string origin_type = 2;
}

// A filter to apply to a handled message.
//
message MessageFilter {

    // The path to the field.
    base.FieldPath field = 1 [(validate) = true];

    // The expected value of the field.
    google.protobuf.Any value = 2 [(validate) = true];
}
