<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!-- NewPage -->
<html lang="en">
<head>
<!-- Generated by javadoc (1.8.0_191) on Sat Jul 13 08:13:21 UTC 2019 -->
<title>Delivery (server 1.0.0-SNAPSHOT API)</title>
<meta name="date" content="2019-07-13">
<link rel="stylesheet" type="text/css" href="../../../../stylesheet.css" title="Style">
<script type="text/javascript" src="../../../../script.js"></script>
</head>
<body>
<script type="text/javascript"><!--
    try {
        if (location.href.indexOf('is-external=true') == -1) {
            parent.document.title="Delivery (server 1.0.0-SNAPSHOT API)";
        }
    }
    catch(err) {
    }
//-->
var methods = {"i0":10,"i1":9,"i2":9,"i3":10,"i4":10};
var tabs = {65535:["t0","All Methods"],1:["t1","Static Methods"],2:["t2","Instance Methods"],8:["t4","Concrete Methods"]};
var altColor = "altColor";
var rowColor = "rowColor";
var tableTab = "tableTab";
var activeTableTab = "activeTableTab";
</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="topNav"><a name="navbar.top">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.top" title="Skip navigation links">Skip navigation links</a></div>
<a name="navbar.top.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../index-all.html">Index</a></li>
<li><a href="../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../../io/spine/server/delivery/CommandEndpoint.html" title="interface in io.spine.server.delivery"><span class="typeNameLink">Prev&nbsp;Class</span></a></li>
<li><a href="../../../../io/spine/server/delivery/Delivery.Builder.html" title="class in io.spine.server.delivery"><span class="typeNameLink">Next&nbsp;Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../../index.html?io/spine/server/delivery/Delivery.html" target="_top">Frames</a></li>
<li><a href="Delivery.html" target="_top">No&nbsp;Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_top">
<li><a href="../../../../allclasses-noframe.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_top");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li><a href="#nested.class.summary">Nested</a>&nbsp;|&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li>Constr&nbsp;|&nbsp;</li>
<li><a href="#method.summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li>Constr&nbsp;|&nbsp;</li>
<li><a href="#method.detail">Method</a></li>
</ul>
</div>
<a name="skip.navbar.top">
<!--   -->
</a></div>
<!-- ========= END OF TOP NAVBAR ========= -->
<!-- ======== START OF CLASS DATA ======== -->
<div class="header">
<div class="subTitle">io.spine.server.delivery</div>
<h2 title="Class Delivery" class="title">Class Delivery</h2>
</div>
<div class="contentContainer">
<ul class="inheritance">
<li>java.lang.Object</li>
<li>
<ul class="inheritance">
<li>io.spine.server.delivery.Delivery</li>
</ul>
</li>
</ul>
<div class="description">
<ul class="blockList">
<li class="blockList">
<hr>
<br>
<pre>public final class <span class="typeNameLabel">Delivery</span>
extends java.lang.Object</pre>
<div class="block">Delivers the messages to the entities.

 <p>Splits the incoming messages into shards and allows to deliver the
 messages to their destinations on a per-shard basis. Guarantees that one and only one
 application server node serves the messages from the given shard at a time, thus preventing
 any concurrent modifications of entity state.

 <p>Delegates the message dispatching and low-level handling of message duplicates to
 <a href="../../../../io/spine/server/delivery/Delivery.html#newInbox-io.spine.type.TypeUrl-"><code>Inbox</code></a>es of each target entity. The respective <code>Inbox</code> instances
 should be created in each of <code>Entity</code> repositories.

 <b>Configuration</b>

 <p>By default, a shard is assigned according to the identifier of the target entity. The messages
 heading to a single entity will always reside in a single shard. However, the framework users
 may <a href="../../../../io/spine/server/delivery/Delivery.Builder.html#setStrategy-io.spine.server.delivery.DeliveryStrategy-">customize</a> this behavior.

 <p><a href="../../../../io/spine/server/delivery/Delivery.Builder.html#setIdempotenceWindow-com.google.protobuf.Duration-">Provides</a> the time-based de-duplication
 capabilities to eliminate the messages, which may have been already delivered to their targets.
 The duplicates will be detected among the messages, which are not older, than
 <code>now - [idempotence window]</code>.

 <p><code>Delivery</code> is responsible for providing the <a href="../../../../io/spine/server/delivery/InboxStorage.html" title="interface in io.spine.server.delivery"><code>InboxStorage</code></a> for every inbox
 registered. Framework users may <a href="../../../../io/spine/server/delivery/Delivery.Builder.html#setInboxStorage-io.spine.server.delivery.InboxStorage-">configure</a> the storage, taking into account that it is typically multi-tenant. By default,
 the <code>InboxStorage</code> for the delivery is provided by the environment-specific
 <a href="../../../../io/spine/server/ServerEnvironment.html#storageFactory--">storage factory</a> and is multi-tenant.

 <p>Once a message is written to the <code>Inbox</code>,
 the <a href="../../../../io/spine/server/delivery/Delivery.html#subscribe-io.spine.server.delivery.ShardObserver-">pre-configured shard observers</a> are
 <a href="../../../../io/spine/server/delivery/ShardObserver.html#onMessage-io.spine.server.delivery.InboxMessage-">notified</a>. In this way any third-party
 environment planners, load balancers, and schedulers may plug into the delivery and perform
 various routines to enable the further processing of the sharded messages. In a distributed
 environment a message queue may be used to notify the node cluster of a shard that has some
 messages pending for the delivery.

 <p>Once an application node picks the shard to deliver the messages from it,
 it registers itself in a <a href="../../../../io/spine/server/delivery/ShardedWorkRegistry.html" title="interface in io.spine.server.delivery"><code>ShardedWorkRegistry</code></a>. It serves as a list of locks-per-shard
 that only allows to pick a shard to a single node at a time.

 <b>Local environment</b>

 <p>By default, the delivery is configured to <a href="../../../../io/spine/server/delivery/Delivery.html#local--">run locally</a>. It
 uses see-and-dispatch observer, which delivers the messages
 from the observed shard once a message is passed to its
 <code>onMessage(InboxMessage)</code> method. This
 process is synchronous.

 <p>To deal with the multi-threaded access in a local mode,
 an <a href="../../../../io/spine/server/delivery/memory/InMemoryShardedWorkRegistry.html" title="class in io.spine.server.delivery.memory">InMemoryShardedWorkRegistry</a> is used. It operates on top of the
 <code>synchronized</code> in-memory data structures and prevents several threads from picking up the
 same shard.</div>
</li>
</ul>
</div>
<div class="summary">
<ul class="blockList">
<li class="blockList">
<!-- ======== NESTED CLASS SUMMARY ======== -->
<ul class="blockList">
<li class="blockList"><a name="nested.class.summary">
<!--   -->
</a>
<h3>Nested Class Summary</h3>
<table class="memberSummary" border="0" cellpadding="3" cellspacing="0" summary="Nested Class Summary table, listing nested classes, and an explanation">
<caption><span>Nested Classes</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colLast" scope="col">Class and Description</th>
</tr>
<tr class="altColor">
<td class="colFirst"><code>static class&nbsp;</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../io/spine/server/delivery/Delivery.Builder.html" title="class in io.spine.server.delivery">Delivery.Builder</a></span></code>
<div class="block">A builder for <code>Delivery</code> instances.</div>
</td>
</tr>
</table>
</li>
</ul>
<!-- ========== METHOD SUMMARY =========== -->
<ul class="blockList">
<li class="blockList"><a name="method.summary">
<!--   -->
</a>
<h3>Method Summary</h3>
<table class="memberSummary" border="0" cellpadding="3" cellspacing="0" summary="Method Summary table, listing methods, and an explanation">
<caption><span id="t0" class="activeTableTab"><span>All Methods</span><span class="tabEnd">&nbsp;</span></span><span id="t1" class="tableTab"><span><a href="javascript:show(1);">Static Methods</a></span><span class="tabEnd">&nbsp;</span></span><span id="t2" class="tableTab"><span><a href="javascript:show(2);">Instance Methods</a></span><span class="tabEnd">&nbsp;</span></span><span id="t4" class="tableTab"><span><a href="javascript:show(8);">Concrete Methods</a></span><span class="tabEnd">&nbsp;</span></span></caption>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colLast" scope="col">Method and Description</th>
</tr>
<tr id="i0" class="altColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../io/spine/server/delivery/Delivery.html#deliverMessagesFrom-io.spine.server.delivery.ShardIndex-">deliverMessagesFrom</a></span>(io.spine.server.delivery.ShardIndex&nbsp;index)</code>
<div class="block">Delivers the messages put into the shard with the passed index to their targets.</div>
</td>
</tr>
<tr id="i1" class="rowColor">
<td class="colFirst"><code>static <a href="../../../../io/spine/server/delivery/Delivery.html" title="class in io.spine.server.delivery">Delivery</a></code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../io/spine/server/delivery/Delivery.html#local--">local</a></span>()</code>
<div class="block">Creates a new instance of <code>Delivery</code> suitable for local and development environment.</div>
</td>
</tr>
<tr id="i2" class="altColor">
<td class="colFirst"><code>static <a href="../../../../io/spine/server/delivery/Delivery.Builder.html" title="class in io.spine.server.delivery">Delivery.Builder</a></code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../io/spine/server/delivery/Delivery.html#newBuilder--">newBuilder</a></span>()</code>
<div class="block">Creates an instance of new <code>Builder</code> of <code>Delivery</code>.</div>
</td>
</tr>
<tr id="i3" class="rowColor">
<td class="colFirst"><code>&lt;I&gt;&nbsp;<a href="../../../../io/spine/server/delivery/Inbox.Builder.html" title="class in io.spine.server.delivery">Inbox.Builder</a>&lt;I&gt;</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../io/spine/server/delivery/Delivery.html#newInbox-io.spine.type.TypeUrl-">newInbox</a></span>(io.spine.type.TypeUrl&nbsp;entityType)</code>
<div class="block">Creates an instance of <a href="../../../../io/spine/server/delivery/Inbox.Builder.html" title="class in io.spine.server.delivery"><code>Inbox.Builder</code></a> for the given entity type.</div>
</td>
</tr>
<tr id="i4" class="altColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../io/spine/server/delivery/Delivery.html#subscribe-io.spine.server.delivery.ShardObserver-">subscribe</a></span>(<a href="../../../../io/spine/server/delivery/ShardObserver.html" title="interface in io.spine.server.delivery">ShardObserver</a>&nbsp;observer)</code>
<div class="block">Subscribes to the updates of shard contents.</div>
</td>
</tr>
</table>
<ul class="blockList">
<li class="blockList"><a name="methods.inherited.from.class.java.lang.Object">
<!--   -->
</a>
<h3>Methods inherited from class&nbsp;java.lang.Object</h3>
<code>clone, equals, finalize, getClass, hashCode, notify, notifyAll, toString, wait, wait, wait</code></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="details">
<ul class="blockList">
<li class="blockList">
<!-- ============ METHOD DETAIL ========== -->
<ul class="blockList">
<li class="blockList"><a name="method.detail">
<!--   -->
</a>
<h3>Method Detail</h3>
<a name="newBuilder--">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>newBuilder</h4>
<pre>public static&nbsp;<a href="../../../../io/spine/server/delivery/Delivery.Builder.html" title="class in io.spine.server.delivery">Delivery.Builder</a>&nbsp;newBuilder()</pre>
<div class="block">Creates an instance of new <code>Builder</code> of <code>Delivery</code>.</div>
</li>
</ul>
<a name="local--">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>local</h4>
<pre>public static&nbsp;<a href="../../../../io/spine/server/delivery/Delivery.html" title="class in io.spine.server.delivery">Delivery</a>&nbsp;local()</pre>
<div class="block">Creates a new instance of <code>Delivery</code> suitable for local and development environment.

 <p>Uses a <a href="../../../../io/spine/server/delivery/UniformAcrossAllShards.html#singleShard--">single-shard</a> splitting.</div>
</li>
</ul>
<a name="deliverMessagesFrom-io.spine.server.delivery.ShardIndex-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>deliverMessagesFrom</h4>
<pre>public&nbsp;void&nbsp;deliverMessagesFrom(io.spine.server.delivery.ShardIndex&nbsp;index)</pre>
<div class="block">Delivers the messages put into the shard with the passed index to their targets.

 <p>At a given moment of time, exactly one application node may serve messages from
 a particular shard. Therefore, in scope of this delivery, an approach based on pessimistic
 locking per-<code>ShardIndex</code> is applied.

 <p>In case the given shard is already processed by some node, this method does nothing.

 <p>The content of the shard is read and delivered on page-by-page basis. The runtime
 exceptions occurring while a page is being delivered are accumulated and then the first
 exception is rethrown, if any.

 <p>After all the pages are read, the delivery process is launched again for the same shard.
 It is required in order to handle the messages, that may have been put to the same shard
 as an outcome of the first-wave messages.

 <p>Once the shard has no more messages to deliver, the delivery process ends, releasing
 the lock for the respective <code>ShardIndex</code>.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>index</code> - the shard index to deliver the messages from.</dd>
</dl>
</li>
</ul>
<a name="newInbox-io.spine.type.TypeUrl-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>newInbox</h4>
<pre>public&nbsp;&lt;I&gt;&nbsp;<a href="../../../../io/spine/server/delivery/Inbox.Builder.html" title="class in io.spine.server.delivery">Inbox.Builder</a>&lt;I&gt;&nbsp;newInbox(io.spine.type.TypeUrl&nbsp;entityType)</pre>
<div class="block">Creates an instance of <a href="../../../../io/spine/server/delivery/Inbox.Builder.html" title="class in io.spine.server.delivery"><code>Inbox.Builder</code></a> for the given entity type.</div>
<dl>
<dt><span class="paramLabel">Type Parameters:</span></dt>
<dd><code>I</code> - the type if entity identifiers</dd>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>entityType</code> - the type of the entity, to which the inbox will belong</dd>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>the builder for the <code>Inbox</code></dd>
</dl>
</li>
</ul>
<a name="subscribe-io.spine.server.delivery.ShardObserver-">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>subscribe</h4>
<pre>public&nbsp;void&nbsp;subscribe(<a href="../../../../io/spine/server/delivery/ShardObserver.html" title="interface in io.spine.server.delivery">ShardObserver</a>&nbsp;observer)</pre>
<div class="block">Subscribes to the updates of shard contents.

 <p>The passed observer will be notified that the contents of a shard with a particular index
 were changed.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>observer</code> - an observer to notify of updates.</dd>
</dl>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<!-- ========= END OF CLASS DATA ========= -->
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div class="bottomNav"><a name="navbar.bottom">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.bottom" title="Skip navigation links">Skip navigation links</a></div>
<a name="navbar.bottom.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../index-all.html">Index</a></li>
<li><a href="../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../../io/spine/server/delivery/CommandEndpoint.html" title="interface in io.spine.server.delivery"><span class="typeNameLink">Prev&nbsp;Class</span></a></li>
<li><a href="../../../../io/spine/server/delivery/Delivery.Builder.html" title="class in io.spine.server.delivery"><span class="typeNameLink">Next&nbsp;Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../../index.html?io/spine/server/delivery/Delivery.html" target="_top">Frames</a></li>
<li><a href="Delivery.html" target="_top">No&nbsp;Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_bottom">
<li><a href="../../../../allclasses-noframe.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_bottom");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li><a href="#nested.class.summary">Nested</a>&nbsp;|&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li>Constr&nbsp;|&nbsp;</li>
<li><a href="#method.summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li>Constr&nbsp;|&nbsp;</li>
<li><a href="#method.detail">Method</a></li>
</ul>
</div>
<a name="skip.navbar.bottom">
<!--   -->
</a></div>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
</body>
</html>
